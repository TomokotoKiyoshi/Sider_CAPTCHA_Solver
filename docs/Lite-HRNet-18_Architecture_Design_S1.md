# Lite-HRNet-18 网络架构设计说明书

## 1. 概述

**网络名称**：Lite-HRNet-18  
**输入规格**：[B, C, H, W] = [B, 4, 256, 512]（RGB + padding mask）

## 2. 设计原则

- **多分辨率**：保持 HRNet 的并行多分辨率特性
- **灵活性**：支持动态输入尺寸，避免硬编码

## 3. 基础组件定义

### 3.1 LiteBlock（MBConv 风格）

**结构**：`PW-Expand (1×1, e=2) → DWConv (3×3, s=1) → PW-Project (1×1) → Residual`

## 4. 网络架构

### 4.1 Stage1 (Stem) - 特征提取阶段

#### 4.1.1 结构表

| 层 | 结构 | 输入→输出 |
|---|---|---|
| Conv1 | 3×3, s=2, 32c, BN+SiLU | [B, 4, 256, 512] → [B, 32, 128, 256] |
| Conv2 | 3×3, s=2, 32c, BN+SiLU | [B, 32, 128, 256] → [B, 32, 64, 128] |
| LiteBlock×2 | e=2, s=1, 32→32 | 保持 [B, 32, 64, 128] |

**输出**：X1 = [B, 32, 64, 128]（高分辨率分支@1/4）

#### 4.1.2 层详细说明

**Conv1：3×3, stride=2, 32 通道，BN+SiLU**
- **输入**：[B, 4, 256, 512]（4 通道 = RGB + padding mask）
- **输出**：[B, 32, 128, 256]
- **功能**：第一次卷积降采样（256×512 → 128×256），将通道数提升至 32，提取初级边缘与颜色/亮度等低层特征，为后续高效计算减少分辨率

**Conv2：3×3, stride=2, 32 通道，BN+SiLU**
- **输入**：[B, 32, 128, 256]
- **输出**：[B, 32, 64, 128]
- **功能**：第二次降采样（128×256 → 64×128），扩大感受野，减少空间维度，保留基础纹理和形状特征，保持 32 通道以便后续 HRNet 分支对齐

**LiteBlock×2：e=2, stride=1, 32→32**
- **输入**：[B, 32, 64, 128]
- **输出**：[B, 32, 64, 128]（分辨率不变）
- **功能**：HRNet 基本残差单元的轻量版本（MBConv 风格），使用深度可分离卷积提取局部特征，保持高分辨率不降采样，通过叠加两层增强特征表达能力
- **扩张倍率**：e=2 表示中间通道扩张倍率，提高非线性表示能力同时保持低计算成本

#### 4.1.3 Stage1 总结

Stage1 作为输入特征提取的 "Stem" 阶段，实现以下目标：
- 通过 Conv1 和 Conv2 连续两次降采样，将输入分辨率从 256×512 降至 64×128，减轻后续计算量
- 使用 LiteBlock×2 在保持高分辨率特征的同时增强表达力
- 为 HRNet 后续多分辨率分支提供丰富的底层特征

## 5. 工程实现要求

### 5.1 参数初始化
- 卷积层：Kaiming Normal 初始化
- BatchNorm：weight=1.0, bias=0.0

### 5.2 数值稳定性
- BatchNorm epsilon: 1e-5

### 5.3 内存优化
- 使用 in-place 操作减少内存占用
- 合理设置 gradient checkpointing

### 5.4 推理优化
- 兼容 TensorRT 加速
- 支持混合精度推理（FP16/INT8）

## 6. 附录

### 6.1 SiLU 激活函数
- 定义：SiLU(x) = x × σ(x)，其中 σ 为 Sigmoid 函数
- 特性：平滑、非单调、自门控
- 优势：相比 ReLU 具有更好的梯度流动性

### 6.2 LiteBlock 详细实现
- Pointwise Expand：1×1 卷积，通道数扩张 e 倍 bias=False → BN → SiLU
- Depthwise Conv：3×3 深度可分离卷积，可选 stride=1，padding=1，groups=64，bias=False → BN → SiLU
- Pointwise Project：1×1 卷积，Conv 1×1，64→32，bias=False → BN
- Residual Connection：添加残差连接
